<Project>

  <Import Project="$(SolutionDir)\build\Thunderstore.props" />

  <Target Name="CustomPublish" AfterTargets="Publish">
    <ItemGroup>
      <FilesToExclude Include="$(PublishDir)\.gitkeep" />
      <FilesToExclude Include="$(PublishDir)\0Harmony.dll" />
      <FilesToExclude Include="$(PublishDir)\Assembly-CSharp.dll" />
      <FilesToExclude Include="$(PublishDir)\BepInEx.dll" />
      <FilesToExclude Include="$(PublishDir)\Mono.Cecil*.dll" />
      <FilesToExclude Include="$(PublishDir)\MonoMod.*.dll" />
      <FilesToExclude Include="$(PublishDir)\Newtonsoft.Json.dll" />
      <FilesToExclude Include="$(PublishDir)\System.*.dll" />
      <FilesToExclude Include="$(PublishDir)\UnityEngine*.dll" />
    </ItemGroup>
    <Delete Files="@(FilesToExclude)" />
  </Target>

  <Target Name="ThunderstorePublish" AfterTargets="CustomPublish">
    <ItemGroup>
      <PackageFiles Include="$(SolutionDir)\LICENSE.txt" />
    </ItemGroup>

    <Copy
      DestinationFolder="$(SolutionDir)\artifacts\tspublish\Core\dist"
      SourceFiles="@(PackageFiles)"
    />

    <Exec
      Command='dotnet tcli publish --package-name "$(Product)" --package-namespace "$(Authors)" --package-version "$(PACKAGE_VERSION)"'
      ConsoleToMSBuild="true"
      WorkingDirectory="$(SolutionDir)\artifacts\tspublish\$(Product)\"
    />
  </Target>

</Project>
